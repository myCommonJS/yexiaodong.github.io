---
layout: post
title:  "SQL之merge"
date:   2016-04-28
categories: SQL
excerpt:  MERGE语句是SQL语句的一种。在SQL Server、Oracle数据库中可用，MySQL、PostgreSQL中不可用。通过MERGE语句，根据一张表。。。
---
# 1 MERGE

 MERGE语句是SQL语句的一种。在SQL Server、Oracle数据库中可用，MySQL、PostgreSQL中不可用。

 通过MERGE语句，根据一张表（原数据表，source table）或子查询的连接条件对另外一张（目标表，target table）表进行查询，连接条件匹配上的进行UPDATE，无法匹配的执行INSERT。这个语法仅需要一次全表扫描就完成了全部工作，执行效率要高于INSERT+UPDATE。
 
 其语法格式如下：

{% highlight SQL %}
MERGE INTO table1 B1 --需要插入的表
USING (select * from table2) B2 --插入数据
ON (B1.CODE = B2.CODE) --判断条件
WHEN NOT MATCHED --条件不成立
THEN INSERT VALUES --THEN后为执行动作
    ( 
     B2.CODE,
     B2.NAME)
{% endhighlight %}
使用marge可以判断的情况有三种，

**两个表都存在：**WHEN MATCHED THEN;

**B1表不存在，B2表存在：**WHEN NOT MATCHED THEN;

**B1表存在，B2表不存在：**WHEN NOT MATCHED BY SOURCE THEN。

[更多详情](http://www.cnblogs.com/ruiati/archive/2013/01/18/2866017.html)